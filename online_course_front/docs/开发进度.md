# 在线课程平台开发进度

## 一、课程管理模块

### 已完成功能

#### 课程基本信息管理
- [x] 课程列表展示
- [x] 课程创建
- [x] 课程基本信息编辑
- [x] 课程状态管理（发布、下线）

#### 课程计划管理
- [x] 章节树形结构展示
- [x] 章节添加/编辑
- [x] 小节添加/编辑
- [x] 章节排序（上移/下移）
- [x] 小节排序（上移/下移）
- [x] 章节删除（含二次确认）
- [x] 小节删除（含二次确认）

#### 课程教师管理
- [x] 课程关联教师功能
  - [x] 显示课程已关联教师列表
  - [x] 关联新教师（带已关联状态）
  - [x] 解除教师关联
  - [x] 查看教师关联的课程列表
- [x] 教师列表优化
  - [x] 添加滚动条限制最大高度
  - [x] 已关联教师状态显示
  - [x] 防止重复关联

#### 课程审核管理
- [x] 管理员课程列表
  - [x] 多条件筛选（机构ID、课程名称、课程状态、审核状态）
  - [x] 分页加载
  - [x] 课程基本信息展示
  - [x] 状态标识
- [x] 课程审核功能
  - [x] 审核对话框
  - [x] 通过/驳回选择
  - [x] 审核意见（驳回必填）
  - [x] 审核状态即时更新

#### 课程封面管理
- [x] 课程封面上传功能
  - [x] 支持图片选择和拖拽上传
  - [x] 图片裁剪功能（固定16:9比例）
  - [x] 临时预览和确认机制
  - [x] 支持更换和删除操作
  - [x] 图片点击放大预览
  - [x] 支持 jpg、png 格式
  - [x] 大小限制（5MB）
  - [x] 集成 Minio 对象存储
  - [x] 错误处理和用户提示

#### 图片处理最佳实践
1. 图片上传流程
   - 选择图片 -> 打开裁剪对话框
   - 裁剪完成 -> 上传到临时存储
   - 显示预览 -> 确认使用或重新选择
   - 确认后 -> 保存到永久存储

2. 图片显示处理
   - 使用 Next.js Image 组件优化加载
   - 提供默认占位图
   - 处理加载失败情况
   - 支持图片放大预览
   - 正确处理图片 URL（Minio 路径）

3. 组件封装
   - ImageUpload：通用上传组件
   - ImageCropper：图片裁剪组件
   - ImagePreview：图片预览组件
   - VisuallyHidden：可访问性支持组件

4. 注意事项
   - 临时文件及时清理
   - 考虑网络状态
   - 添加加载状态
   - 友好的错误提示
   - 支持键盘操作
   - 考虑可访问性

### 访问路径
- 公开课程列表：`/courses`（展示所有已审核通过的课程）
- 机构课程管理：`/organization/courses`（机构管理自己的课程）
  - 课程列表（所有状态）
  - 创建课程
  - 课程管理操作
- 课程创建页：`/organization/courses/create`
- 课程编辑页：`/organization/courses/{courseId}/edit`
  - 课程基本信息
  - 课程计划管理（章节管理）
  - 课程教师管理（开发中）
  - 课程资源管理（开发中）

### 待开发功能

#### 机构课程管理
- [ ] 机构课程列表页面
  - [ ] 按机构ID筛选
  - [ ] 显示所有状态课程
  - [ ] 课程状态标签
  - [ ] 课程操作菜单
- [ ] 移动创建课程入口
- [ ] 优化课程管理流程

#### 课程教师管理
- [ ] 教师列表展示
- [ ] 添加教师
- [ ] 删除教师
- [ ] 教师排序

#### 课程资源管理
- [ ] 课程图片上传
- [ ] 课程资料上传
- [ ] 资源预览
- [ ] 资源删除

#### 课程审核流程
- [ ] 课程审核状态管理
  - [ ] 提交审核
  - [ ] 审核状态显示
  - [ ] 审核结果处理
  - [ ] 驳回后重新提交

#### 课程详情预览
- [ ] 课程详情预览

#### 审核历史记录
- [ ] 审核历史记录

#### 审核数据统计
- [ ] 审核数据统计

### 开发经验总结

#### 3.1 临时方案说明
1. 用户认证和机构隔离
   - 开发阶段在表单中手动填写机构ID
   - 课程列表支持按机构ID筛选
   - 创建课程时手动输入机构ID
   - 便于测试不同机构的数据隔离
   - 后续需要改造：
     - 接入统一认证系统后，移除手动填写机构ID的字段
     - 改为从登录用户信息中获取机构ID
     - 添加机构切换功能（如果需要）
     - 实现基于用户权限的数据隔离
   - 使用TODO标记需要更新的地方：
     ```typescript
     // TODO: 后续需要从登录用户信息中获取机构ID，移除手动填写
     interface CourseFormData {
       organizationId: number; // 临时：手动填写机构ID，后续将从用户信息中获取
       // ... 其他字段
     }
     ```

2. 数据管理
   - 使用乐观更新策略
   - 操作后立即刷新列表
   - 添加了错误处理和用户提示

#### 3.2 组件设计经验
1. 表单处理
   - 使用zod进行表单验证
   - 统一的错误提示风格
   - 表单状态管理最佳实践

2. 用户体验
   - 添加了必要的加载状态
   - 操作后的即时反馈
   - 优化了空状态显示
   - 添加了二次确认对话框
   - 使用标签页组织内容

3. 代码组织
   - 组件职责划分清晰
   - 复用公共组件和hooks
   - 统一的API调用方式
   - 完善的类型定义

### 4. 待开发功能
- [ ] 课程封面管理
- [ ] 课程教师管理
- [ ] 课程资源管理
- [ ] 课程审核流程完善

### 5. 优化计划
1. 性能优化
   - 考虑添加批量操作
   - 优化数据加载策略
   - 添加缓存机制

2. 功能增强
   - 拖拽排序
   - 章节复制
   - 批量导入
   - 课程预览

3. 体验优化
   - 添加更多交互反馈
   - 优化表单验证
   - 完善错误处理
   - 添加操作引导

## 二、开发规范

### 1. 代码规范
- 使用TypeScript进行类型检查
- 遵循ESLint规则
- 使用Prettier进行代码格式化

### 2. 组件开发规范
- 职责单一原则
- 合理的组件分层
- 统一的状态管理
- 完善的注释说明

### 3. API调用规范
- 统一的请求处理
- 错误处理标准化
- 响应数据类型定义
- 接口参数校验

### 4. 文档维护
- 及时更新开发进度
- 记录重要决策
- 标注临时方案
- 添加关键实现说明

## 三、项目结构说明

### 1. 组件结构
```
src/
├── components/
│   └── courses/
│       ├── course-form.tsx      # 课程创建表单
│       ├── course-list.tsx      # 课程列表组件
│       ├── course-filter.tsx    # 课程筛选组件
│       ├── course-chapter-list.tsx  # 课程章节列表
│       ├── chapter-form.tsx     # 章节表单
│       └── section-form.tsx     # 小节表单
```

### 2. 页面结构
```
src/
└── app/
    └── courses/
        ├── page.tsx             # 课程列表页
        ├── create/
        │   └── page.tsx         # 课程创建页
        └── [id]/
            └── edit/
                └── page.tsx     # 课程编辑页
```

### 3. 服务和工具
```
src/
├── services/
│   ├── index.ts                # API请求封装
│   └── course.ts               # 课程相关API
└── config/
    └── api.config.ts           # API配置
```

## 下一步开发建议

1. 完善课程教师管理功能
   - 实现教师选择和绑定
   - 支持多个教师管理
   - 设置主讲教师

2. 开发课程资源管理功能
   - 集成文件上传组件
   - 支持图片预览
   - 支持文档在线预览

3. 完善课程审核流程
   - 审核状态流转
   - 审核意见展示
   - 驳回后修改流程

4. 优化用户体验
   - 添加加载状态展示
   - 优化表单验证提示
   - 添加操作引导

5. 系统集成
   - 对接用户认证
   - 集成权限控制
   - 添加操作日志 